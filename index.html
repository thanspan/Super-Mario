<!DOCTYPE HTML>
<html>
<head>
<title>Super-Mario</title>
<meta charset="utf-8">
<style>
body {
	margin: 0;
	padding: 0;
	background-color: 	#000;
}
</style>
<script src = "menu.js"></script>
<script src = "lvl1.js"></script>
<script src = "gameover.js"></script>
<script src="//cdn.jsdelivr.net/phaser/2.6.2/phaser.min.js"></script>
</head>
<body>
	<script type="text/javascript">
		var game = new Phaser.Game(256, 240, Phaser.CANVAS, '', this, false, false);
		function preload(){
		this.load.baseURL = 'https://thanspan.github.io/Super-Mario/';
		this.load.crossOrigin = 'anonymous';
		}	
		
        var musicbs;
        var score=0;
        var scoretxt;
        var lives=3;
        var livesco;
        var livesimg;
        
		
		game.state.add('lvl1', lvl1);
		game.state.add('gameover', gameover);
		game.state.add('menu', menu);
		game.state.start('menu');
		
	var coinsoundkill;
        var goombask;
        var deathsk;
        
		function coinOverlap(player, coin) {
			coinsoundkill = game.add.audio('coinsound');
			coinsoundkill.play();
		    coin.kill();
		    score += 10;
    			scoretxt.text = 'Score: ' + score;        
		} 
		
		function goombaOverlap(player, goomba) {
			
			if (player.body.touching.down) {
				goombask = game.add.audio('doorsound');
				goombask.play();
				goomba.animations.stop();
				goomba.frame = 2;
				goomba.body.enable = false;
				player.body.velocity.y = -80;
				game.time.events.add(Phaser.Timer.SECOND, function() {
		
				 score += 50;
    			scoretxt.text = 'Score: ' + score; 
					goomba.kill();
				});
			} else {
                
                musicbs.stop();
                
                deathsk = game.add.audio('deathsound');
                deathsk.play();
                
                if(lives>1){
					setTimeout(function(){
					score=0;
					lives-=1;				
    		    		game.state.start(game.state.current);
    		   		 }, 2500);
    					} else {
				setTimeout(function(){
				game.state.start('gameover');	
				}, 2500);}
                             
				player.frame = 6;
				player.body.enable = false;
				player.animations.stop();
				game.time.events.add(Phaser.Timer.SECOND * 5, function() {
					game.paused = true;
				});
			}
		}
		function enemyOverlap(player, enemy) {
			
			if (player.body.touching.down) {
				goombask = game.add.audio('doorsound');
				goombask.play();
				enemy.animations.stop();
				enemy.frame = 2;
				enemy.body.enable = false;
				player.body.velocity.y = -80;
				game.time.events.add(Phaser.Timer.SECOND, function() {
		
				 score += 50;
    			scoretxt.text = 'Score: ' + score; 
					enemy.kill();
				});
			} else {
                
                musicbs.stop();
                
                deathsk = game.add.audio('deathsound');
                deathsk.play();
                
                if(lives>1){
					setTimeout(function(){
					score=0;
					lives-=1;				
    		    		game.state.start(game.state.current);
    		   		 }, 2500);
    					} else {
				setTimeout(function(){
				game.state.start('gameover');
				}, 2500);}
                             
				player.frame = 6;
				player.body.enable = false;
				player.animations.stop();
				game.time.events.add(Phaser.Timer.SECOND * 5, function() {
					game.paused = true;
				});
			}
		}
		function pipeOverlap(player,pipe){
	        if (cursors.down.isDown && (player.body.onFloor())) {
		       pipesound.play();
		       player.body.enable=false;
		       game.time.events.add(Phaser.Timer.SECOND*1.1 , function() {
					player.body.enable=true;
					player.reset(1415,150);
					});
	}
}
		function nextstage(){
		        //lvl = game.add.audio('lvl');
			
			
			var style5 = { font: "bold 80px Roman", fill: "#4bb84b", boundsAlignH: "center", boundsAlignV: "middle" };
			lvltext = game.add.text(280, 100, "CONGRATULATIONS", style5);
			lvltext = game.add.text(280, 150, "NEXT STAGE", style5);
			lvltext.fixedToCamera = true;
			theme.stop();
			//lvl.play();
			player.body.enable = false;
			player.animations.stop();
			game.time.events.add(Phaser.Timer.SECOND * 5, function() {
			//game.state.start('S2');
			}); 
			//game.paused = true;
		}
		
		function doorcollide(player, door){
			if (player.body.touching.up){
				door.body.enable = false;
				nextsatge();
			}else if (player.body.touching.right){
				door.body.enable = false;
				nextstage();
			}else if (player.body.touching.left){
				door.body.enable = false;
			        nextstage();
				
			}else
				door.body.enable = false;
				nextstage();
		}
		
		}
	</script>
	</body>
</html>
